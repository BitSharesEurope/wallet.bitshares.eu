(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{1940:function(e,t,n){"use strict";const a=n(1941),o=n(1942);function s(e,t){return t.encode?t.strict?a(e):encodeURIComponent(e):e}function r(e,t){return t.decode?o(e):e}function c(e){const t=e.indexOf("?");return-1===t?"":e.slice(t+1)}function i(e,t){const n=function(e){let t;switch(e.arrayFormat){case"index":return(e,n,a)=>{t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===a[e]&&(a[e]={}),a[e][t[1]]=n):a[e]=n};case"bracket":return(e,n,a)=>{t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==a[e]?a[e]=[].concat(a[e],n):a[e]=[n]:a[e]=n};default:return(e,t,n)=>{void 0!==n[e]?n[e]=[].concat(n[e],t):n[e]=t}}}(t=Object.assign({decode:!0,arrayFormat:"none"},t)),a=Object.create(null);if("string"!=typeof e)return a;if(!(e=e.trim().replace(/^[?#&]/,"")))return a;for(const o of e.split("&")){let[e,s]=o.replace(/\+/g," ").split("=");s=void 0===s?null:r(s,t),n(r(e,t),s,a)}return Object.keys(a).sort().reduce((e,t)=>{const n=a[t];return Boolean(n)&&"object"==typeof n&&!Array.isArray(n)?e[t]=function e(t){return Array.isArray(t)?t.sort():"object"==typeof t?e(Object.keys(t)).sort((e,t)=>Number(e)-Number(t)).map(e=>t[e]):t}(n):e[t]=n,e},Object.create(null))}t.extract=c,t.parse=i,t.stringify=((e,t)=>{!1===(t=Object.assign({encode:!0,strict:!0,arrayFormat:"none"},t)).sort&&(t.sort=(()=>{}));const n=function(e){switch(e.arrayFormat){case"index":return(t,n,a)=>null===n?[s(t,e),"[",a,"]"].join(""):[s(t,e),"[",s(a,e),"]=",s(n,e)].join("");case"bracket":return(t,n)=>null===n?[s(t,e),"[]"].join(""):[s(t,e),"[]=",s(n,e)].join("");default:return(t,n)=>null===n?s(t,e):[s(t,e),"=",s(n,e)].join("")}}(t);return e?Object.keys(e).sort(t.sort).map(a=>{const o=e[a];if(void 0===o)return"";if(null===o)return s(a,t);if(Array.isArray(o)){const e=[];for(const t of o.slice())void 0!==t&&e.push(n(a,t,e.length));return e.join("&")}return s(a,t)+"="+s(o,t)}).filter(e=>e.length>0).join("&"):""}),t.parseUrl=((e,t)=>({url:e.split("?")[0]||"",query:i(c(e),t)}))},1941:function(e,t,n){"use strict";e.exports=(e=>encodeURIComponent(e).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`))},1942:function(e,t,n){"use strict";var a=new RegExp("%[a-f0-9]{2}","gi"),o=new RegExp("(%[a-f0-9]{2})+","gi");function s(e,t){try{return decodeURIComponent(e.join(""))}catch(e){}if(1===e.length)return e;t=t||1;var n=e.slice(0,t),a=e.slice(t);return Array.prototype.concat.call([],s(n),s(a))}function r(e){try{return decodeURIComponent(e)}catch(o){for(var t=e.match(a),n=1;n<t.length;n++)t=(e=s(t,n).join("")).match(a);return e}}e.exports=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return function(e){for(var t={"%FE%FF":"��","%FF%FE":"��"},n=o.exec(e);n;){try{t[n[0]]=decodeURIComponent(n[0])}catch(e){var a=r(n[0]);a!==n[0]&&(t[n[0]]=a)}n=o.exec(e)}t["%C2"]="�";for(var s=Object.keys(t),c=0;c<s.length;c++){var i=s[c];e=e.replace(new RegExp(i,"g"),t[i])}return e}(e)}}},2051:function(e,t,n){"use strict";n.r(t),function(e){var a=n(717),o=n(300),s=n(0),r=n.n(s),c=n(329),i=n(45),l=n(3),u=n.n(l),m=n(195),f=n(246),d=n(25),h=n(299),p=n(15),b=n(16),g=n.n(b),_=n(96),v=n(1790),y=n(11),A=n.n(y),k=n(10),E=n(33),S=n(138),j=n(5),C=n.n(j),w=n(27),x=n(1940),F=n.n(x),O=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();var I=function(t){function n(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e)),a=n.getInitialState(),s=F.a.parse(e.location.search)||{};s.from&&(a.from_name=s.from,k.b.getAccount(s.from)),s.to&&(a.to_name=s.to,k.b.getAccount(s.to)),s.amount&&(a.amount=s.amount),s.asset&&(a.asset_id=s.asset,a.asset=k.b.getAsset(s.asset)),s.memo&&(a.memo=s.memo);var r=d.a.getState().currentAccount;return a.from_name||(a.from_name=r),t.state=a,t.onTrxIncluded=t.onTrxIncluded.bind(t),t._updateFee=Object(o.a)(t._updateFee.bind(t),250),t._checkFeeStatus=t._checkFeeStatus.bind(t),t._checkBalance=t._checkBalance.bind(t),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,r.a.Component),O(n,[{key:"componentWillMount",value:function(){this.nestedRef=null,this._updateFee(),this._checkFeeStatus()}},{key:"shouldComponentUpdate",value:function(e,t){var n=this._getAvailableAssets().asset_types,a=this._getAvailableAssets(t).asset_types;if(1===a.length){var o=k.b.getAsset(a[0]);1!==n.length&&this.onAmountChanged({amount:t.amount,asset:o}),a[0]!==this.state.fee_asset_id&&o&&this.state.fee_asset_id!==a[0]&&this.setState({feeAsset:o,fee_asset_id:a[0]})}return!0}},{key:"componentWillReceiveProps",value:function(e){var t=this;e.currentAccount!==this.state.from_name&&e.currentAccount!==this.props.currentAccount&&this.setState({from_name:e.currentAccount,from_account:k.b.getAccount(e.currentAccount),feeStatus:{},fee_asset_id:"1.3.0",feeAmount:new w.a({amount:0})},function(){t._updateFee(),t._checkFeeStatus(k.b.getAccount(e.currentAccount))})}},{key:"_checkBalance",value:function(){var e=this.state,t=e.feeAmount,n=e.amount,a=e.from_account,o=e.asset;if(o&&a){var s=a.getIn(["balances",o.get("id")]),r=a.getIn(["balances",t.asset_id]);if(o&&a){if(!s)return this.setState({balanceError:!0});var c=k.b.getObject(s),i=r?k.b.getObject(r):null;if(i&&0!==i.get("balance")||this.setState({fee_asset_id:"1.3.0"},this._updateFee),c&&t){var l=Object(S.a)(n,o,t,c);null!==l&&this.setState({balanceError:!l})}}}}},{key:"_checkFeeStatus",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state.from_account;if(t){var n=Object.keys(t.get("balances").toJS()).sort(p.a.sortID),a={},o=[];n.forEach(function(n){o.push(Object(S.b)({accountID:t.get("id"),feeID:n,options:["price_per_kbyte"],data:{type:"memo",content:e.state.memo}}))}),Promise.all(o).then(function(t){n.forEach(function(e,n){a[e]=t[n]}),p.a.are_equal_shallow(e.state.feeStatus,a)||e.setState({feeStatus:a}),e._checkBalance()}).catch(function(e){console.error(e)})}}},{key:"_updateFee",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state,n=t.fee_asset_id,a=t.from_account,o=t.asset_id,s=this._getAvailableAssets(t).fee_asset_types;if(1===s.length&&s[0]!==n&&(n=s[0]),!a)return null;Object(S.b)({accountID:a.get("id"),feeID:n,options:["price_per_kbyte"],data:{type:"memo",content:t.memo}}).then(function(t){var n=t.fee,s=t.hasBalance,r=t.hasPoolBalance;return Object(S.d)(a,n).then(function(t){return t?e.setState({fee_asset_id:o},e._updateFee):e.setState({feeAmount:n,fee_asset_id:n.asset_id,hasBalance:s,hasPoolBalance:r,error:!s||!r})})})}},{key:"fromChanged",value:function(e){e||this.setState({from_account:null}),this.setState({from_name:e,error:null,propose:!1,propose_account:""})}},{key:"toChanged",value:function(e){this.setState({to_name:e,error:null})}},{key:"onFromAccountChanged",value:function(e){var t=this;this.setState({from_account:e,error:null},function(){t._updateFee(),t._checkFeeStatus()})}},{key:"onToAccountChanged",value:function(e){this.setState({to_account:e,error:null})}},{key:"onAmountChanged",value:function(e){var t=e.amount,n=e.asset;n&&this.setState({amount:t,asset:n,asset_id:n.get("id"),error:null},this._checkBalance)}},{key:"onFeeChanged",value:function(e){var t=e.asset;this.setState({feeAsset:t,fee_asset_id:t.get("id"),error:null},this._updateFee)}},{key:"onMemoChanged",value:function(e){this.setState({memo:e.target.value},this._updateFee)}},{key:"onTrxIncluded",value:function(e){e.included&&e.broadcasted_transaction?(_.a.unlisten(this.onTrxIncluded),_.a.reset()):e.closed&&(_.a.unlisten(this.onTrxIncluded),_.a.reset())}},{key:"onPropose",value:function(e,t){t.preventDefault(),this.setState({propose:e,propose_account:null})}},{key:"onProposeAccount",value:function(e){this.setState({propose_account:e})}},{key:"resetForm",value:function(){this.setState({memo:"",to_name:"",amount:""})}},{key:"onSubmit",value:function(t){var n=this;t.preventDefault(),this.setState({error:null});var a=this.state,o=a.asset,s=a.amount,r=new w.a({real:s,asset_id:o.get("id"),precision:o.get("precision")});i.a.transfer(this.state.from_account.get("id"),this.state.to_account.get("id"),r.getAmount(),o.get("id"),this.state.memo?new e(this.state.memo,"utf-8"):this.state.memo,this.state.propose?this.state.propose_account:null,this.state.feeAsset?this.state.feeAsset.get("id"):"1.3.0").then(function(){n.resetForm.call(n),_.a.unlisten(n.onTrxIncluded),_.a.listen(n.onTrxIncluded)}).catch(function(e){var t=e.message?e.message.split("\n")[1]||e.message:null;console.log("error: ",e,t),n.setState({error:t})})}},{key:"setNestedRef",value:function(e){this.nestedRef=e}},{key:"_setTotal",value:function(e,t){var n=this.state.feeAmount,a=k.b.getObject(t),o=k.b.getObject(e),s=new w.a({amount:a.get("balance"),asset_id:o.get("id"),precision:o.get("precision")});a&&(n.asset_id===s.asset_id&&s.minus(n),this.setState({amount:s.getAmount({real:!0})},this._checkBalance))}},{key:"_getAvailableAssets",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.state,t=this.state.feeStatus;var n=e.from_account,a=e.from_error,o=[],s=[];if(!n||!n.get("balances")||a)return{asset_types:o,fee_asset_types:s};var r=e.from_account.get("balances").toJS();for(var c in o=Object.keys(r).sort(p.a.sortID),s=Object.keys(r).sort(p.a.sortID),r){var i=k.b.getObject(r[c]);i&&0===i.get("balance")&&(o.splice(o.indexOf(c),1),-1!==s.indexOf(c)&&s.splice(s.indexOf(c),1))}return{asset_types:o,fee_asset_types:s=s.filter(function(e){return function(e){return void 0===t[e]||t[e]&&t[e].hasPoolBalance}(e)&&function(e){return void 0===t[e]||t[e]&&t[e].hasBalance}(e)})}}},{key:"render",value:function(){var e=null,t=this.state,n=t.propose,o=t.from_account,s=t.to_account,i=t.asset,l=t.asset_id,p=t.propose_account,b=t.feeAmount,_=t.amount,y=t.error,E=t.to_name,S=t.from_name,j=t.memo,w=t.feeAsset,x=t.fee_asset_id,F=t.balanceError,O=d.a.isMyAccount(o)||S===this.props.passwordAccount;!o||O||n||(e=r.a.createElement("span",null,g.a.translate("account.errors.not_yours")," (",r.a.createElement("a",{onClick:this.onPropose.bind(this,!0)},g.a.translate("propose")),")"));var I=this._getAvailableAssets(),N=I.asset_types,B=I.fee_asset_types,T=null,P=this.state.feeAmount.getAmount({real:!0});if(o&&o.get("balances")&&!e){var R=o.get("balances").toJS();if(1===N.length&&(i=k.b.getAsset(N[0])),N.length>0){var U=i?i.get("id"):N[0],D=w?w.get("id"):"1.3.0";T=r.a.createElement("span",{style:{borderBottom:"#A09F9F 1px dotted",cursor:"pointer"},onClick:this._setTotal.bind(this,U,R[U],P,D)},r.a.createElement(u.a,{component:"span",content:"transfer.available"}),":"," ",r.a.createElement(c.a,{balance:R[U]}))}else T="No funds"}var J=n&&!p,M=parseFloat(String.prototype.replace.call(_,/,/g,"")),$=M&&!Object(a.a)(M),z=s&&s.get("name")===E,q=!o||!z||!$||!i||e||J||F,L=A.a.Set();L=L.add(o);var V=1;return r.a.createElement("div",{className:"grid-block vertical"},r.a.createElement("div",{className:"grid-block shrink vertical medium-horizontal",style:{paddingTop:"2rem"}},r.a.createElement("form",{style:{paddingBottom:20,overflow:"visible"},className:"grid-content small-12 medium-6 large-5 large-offset-1 full-width-content",onSubmit:this.onSubmit.bind(this),noValidate:!0},r.a.createElement(u.a,{content:"transfer.header",component:"h2"}),r.a.createElement("div",{className:"content-block"},r.a.createElement(f.a,{label:"transfer.from",ref:"from",accountName:S,onChange:this.fromChanged.bind(this),onAccountChanged:this.onFromAccountChanged.bind(this),account:o,size:60,error:e,typeahead:!0,tabIndex:V++})),r.a.createElement("div",{className:"content-block"},r.a.createElement(f.a,{label:"transfer.to",ref:"to",accountName:E,onChange:this.toChanged.bind(this),onAccountChanged:this.onToAccountChanged.bind(this),account:s,size:60,tabIndex:V++,typeahead:!0})),r.a.createElement("div",{className:"content-block transfer-input"},r.a.createElement(h.a,{label:"transfer.amount",amount:_,onChange:this.onAmountChanged.bind(this),asset:N.length>0&&i?i.get("id"):l||N[0],assets:N,display_balance:T,tabIndex:V++}),this.state.balanceError?r.a.createElement("p",{className:"has-error no-margin",style:{paddingTop:10}},r.a.createElement(u.a,{content:"transfer.errors.insufficient"})):null),r.a.createElement("div",{className:"content-block transfer-input"},j&&j.length?r.a.createElement("label",{className:"right-label"},j.length):null,r.a.createElement(u.a,{className:"left-label tooltip",component:"label",content:"transfer.memo","data-place":"top","data-tip":g.a.translate("tooltip.memo_tip")}),r.a.createElement("textarea",{style:{marginBottom:0},rows:"3",value:j,tabIndex:V++,onChange:this.onMemoChanged.bind(this)}),this.state.propose?r.a.createElement("div",{className:"error-area",style:{position:"absolute"}},r.a.createElement(u.a,{content:"transfer.warn_name_unable_read_memo",name:this.state.from_name})):null),r.a.createElement("div",{className:"content-block transfer-input fee-row"+(this.state.propose?" proposal":"")},r.a.createElement(h.a,{refCallback:this.setNestedRef.bind(this),label:"transfer.fee",disabled:!0,amount:P,onChange:this.onFeeChanged.bind(this),asset:B.length&&b?b.asset_id:1===B.length?B[0]:x||B[0],assets:B,tabIndex:V++,error:!1===this.state.hasPoolBalance?"transfer.errors.insufficient":null}),n?r.a.createElement("button",{className:C()("button float-right no-margin",{disabled:q}),type:"submit",value:"Submit",tabIndex:V++},r.a.createElement(u.a,{component:"span",content:"propose"})):r.a.createElement("button",{className:C()("button float-right no-margin",{disabled:q}),type:"submit",value:"Submit",tabIndex:V++},r.a.createElement(u.a,{component:"span",content:"transfer.send"}))),n?r.a.createElement("div",{className:"full-width-content form-group transfer-input"},r.a.createElement("label",{className:"left-label"},r.a.createElement(u.a,{content:"account.propose_from"})),r.a.createElement(m.a,{account_names:d.a.getMyAccounts(),onChange:this.onProposeAccount.bind(this),tabIndex:V++})):null,y?r.a.createElement("div",{className:"content-block has-error"},y):null,r.a.createElement("div",null,n?r.a.createElement("span",null,r.a.createElement("button",{className:" button",onClick:this.onPropose.bind(this,!1),tabIndex:V++},r.a.createElement(u.a,{component:"span",content:"cancel"}))):null)),r.a.createElement("div",{className:"grid-content small-12 medium-6 large-4 large-offset-1 right-column"},r.a.createElement("div",{className:"grid-content no-padding"},r.a.createElement(v.a,{accountsList:L,limit:25,compactView:!0,filter:"transfer",fullHeight:!0}))),r.a.createElement("div",{className:"grid-content medium-6 large-4"})))}}],[{key:"getInitialState",value:function(){return{from_name:"",to_name:"",from_account:null,to_account:null,amount:"",asset_id:null,asset:null,memo:"",error:null,propose:!1,propose_account:"",feeAsset:null,fee_asset_id:"1.3.0",feeAmount:new w.a({amount:0}),feeStatus:{}}}}]),n}();t.default=Object(E.connect)(I,{listenTo:function(){return[d.a]},getProps:function(){return{currentAccount:d.a.getState().currentAccount,passwordAccount:d.a.getState().passwordAccount,contactsList:d.a.getState().accountContacts}}})}.call(this,n(114).Buffer)}}]);